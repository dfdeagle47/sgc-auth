define("SGAjax",[],function(){var t=require("backbone"),e=t.sync;t.getBearer=function(){return"bearer "+localStorage.token},t.getAuthorization=function(){return{Authorization:t.getBearer()}},t.setAuthorization=function(t){return localStorage.token=t},t.sync=function(r,a,o){return void 0===o&&(o=a,a=void 0),o=_.defaults(o||{},{contentType:"application/json; charset=utf-8",auth:!0}),o.auth&&(delete o.auth,o.headers=_.extend(o.headers,t.getAuthorization())),o.data&&(o.data=JSON.stringify(o.data)),e.apply(this,[r,a,o])}}),define("AuthModel",[],function(){var t=require("backbone");return t.Model.extend({sync:function(e,r,a){return a.url&&this.testUrl&&(a.url=this.testUrl+a.url,a.headers={"Access-Control-Allow-Origin":"*"}),e||(e="read"),t.Model.prototype.sync.apply(this,[e,r,a])},getLocalStorageAttributes:function(){return this._localStorageAttributes||(this._localStorageAttributes={}),this._localStorageAttributes},set:function(e,r,a){return a=_.defaults(a||{},{localStorage:!1}),a.localStorage?void(_.isString(e)&&(localStorage[e]=r,this.getLocalStorageAttributes()[e]=!0)):t.Model.prototype.set.apply(this,arguments)},has:function(e){return e in this.getLocalStorageAttributes()?!0:t.Model.prototype.has.apply(this,arguments)},get:function(e){var r=t.Model.prototype.get.apply(this,arguments);return!r&&this.getLocalStorageAttributes()[e]?localStorage[e]:r},clear:function(){for(var e=_.keys(this.getLocalStorageAttributes()),r=e.length-1;r>=0;r--)delete localStorage[e[r]];this._localStorageAttributes={};var a=t.Model.prototype.clear.apply(this,arguments);return a},register:function(t){return this.sync(null,this,{url:"/auth/user/register",type:"POST",data:t,auth:!1})},validateToken:function(t,e,r){var a=this;return this.sync(null,this,{url:"/auth/validation",type:"POST",data:{username:t,password:e,token:r},auth:!1}).done(function(t){"token"in t&&"user"in t&&(a.set("token",t.token,{localStorage:!0}),a.set("id",t.user.username,{localStorage:!0}))}).fail(function(){a.clear()})},login:function(t,e){var r=$.Deferred(),a=this;return this.sync(null,this,{url:"/auth/login",type:"POST",data:{username:t,password:e},auth:!1,success:function(t){"token"in t&&"user"in t?(a.set("token",t.token,{localStorage:!0}),a.set("id",t.user.username,{localStorage:!0}),r.resolve(),a.set("state","LOGIN")):r.reject()}}).fail(function(){a.clear(),r.reject()}),r.promise()},forgotPassword:function(t,e){return this.sync(null,this,{url:"/auth/forgot_password",type:"POST",data:{username:t,lang:e},auth:!1})},changePassword:function(t,e){var r=this;return this.sync(null,this,{url:"/auth/change_password",type:"POST",data:{password:t,new_password:e},auth:!0}).done(function(t){"token"in t&&r.set("token",t.token,{localStorage:!0})})},logout:function(){var t=this.sync(null,this,{url:"/auth/logout",type:"POST",data:{},dataType:void 0,auth:!0});return this.clear(),this.set("state","LOGOUT"),t},resetPassword:function(t,e,r){var a=this;return this.sync(null,this,{url:"/auth/user/reset_password",type:"POST",data:{username:t,password:e,token:r},auth:!1}).done(function(t){"token"in t&&"user"in t&&(a.set("token",t.token,{localStorage:!0}),a.set("id",t.user.username,{localStorage:!0}))})},reverse_validation:function(t,e,r){var a="/auth/reverse_validation";e&&r&&(a+="?token="+r+"&id="+e);var o=this;return this.sync(null,this,{url:a,type:"POST",data:t}).done(function(t){"token"in t&&"user"in t&&(o.set("token",t.token,{localStorage:!0}),o.set("id",t.user.username,{localStorage:!0}),App.layout.isLoggedIn(),o.set("_id",t.user._id,{localStorage:!0}),o.set("slug",t.user.slug,{localStorage:!0}))}).fail(function(){o.clear()})}})}),define("sgc-auth",["require","./SGAjax","./AuthModel"],function(t){return t("./SGAjax"),t("./AuthModel")});